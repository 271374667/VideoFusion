# 视频设置

## 设置输出文件路径

在这里设置输出文件夹的路径，需要注意，该路径内部最好不要存放其他文件，有可能会被输出的同名文件覆盖

默认情况下会在本地创建一个 output 文件夹并输出

## 视频去色带

色带是视频中常见的一种瑕疵，尤其在8位YUV格式的视频中2。它产生的原因是编码精度不足。具体来说，由于8位编码的限制，颜色渐变区域的编码值数量不足，导致显示器上的渐变效果被表现成了明显的色阶。

![视频去色带](/视频去色带.png)


## 视频去色块

块效应通常出现在视频的低比特率压缩中，尤其是在使用块编码（如H.264、MPEG-2等）时，视频中有块状分区

![视频去色块](/视频去色块.png)

## 视频去抖动

视频去抖动，参考了这位大佬的代码: https://github.com/lengkujiaai/video_stabilization

![视频去抖动](/live_stabilization.gif)

::: warning 警告
同时该选项会出现大量黑边
:::

## 输出视频帧率

视频帧率越高，视频越流畅，但是处理时长越长

![视频帧率对画面的影响](/视频帧率对画面的影响.gif)

## 去黑边采样帧率

该选项可以控制去黑边的采样率，VideoFusion 会从视频里面获取这些数量的帧，然后对他们每一张进行去黑边处理，最后获取出现次数最高的可能性作为整个视频的去黑边基础，所以如果您发现您的视频被剪裁多了，您可以尝试加大该选项的值

::: tip 提示
仅在使用静态去黑边算法的时候该选项有效,[点我跳转到静态去黑边文档处](#静态去黑边)
:::

## 视频黑边去除算法

### 静态去黑边

通过自研的算法实现单张去黑边，然后将整个视频去黑边的结果进行统计，出现次数最多的作为视频真正的去黑边值，适合在静态图片的时候使用，该选项在视频较短的时候速度比动态去黑边快很多，但是准确率有待提高

### 动态去黑边(推荐)

使用变动画面叠加的方式来获取到持续发生改变的区域，该区域作为真正的画面（默认黑边不会动），如果黑边是会动的黑边那么则无法实现去黑边，可以尝试使用静态去黑边，或者使用专业软件进行剪裁

![去黑边算法](/black_remover.png)

## 视频音量自动调整

用于解决视频音量过大或者过小的问题，响度标准来自中国政府统一标准

《国家广播电视总局关于发布《网络视听节目音频响度技术要求和测量方法》等三项广播电视和网络视听行业标准的通知》：https://www.gov.cn/zhengce/zhengceku/202308/content_6900294.htm

目前一共有 4 种可以设置的值

1. 关闭
2. 电台（适合嘈杂的环境）
3. TV（适合普通环境）
4. 电影（适合安静环境）

## 音频降噪

### 静态降噪

通过削去高频和低频的声音达到降噪的目的，参数经过测试可以实现大部分的降噪效果，速度快，但是对音乐或者特殊场合支持不友好，可能会消去重要声音

### AI 降噪（推荐）

使用 FFmpeg 的 arnndn 模型对音频进行降噪，速度同样也很快，不过对音乐的高频部分有部分削弱

## 视频降噪

### bilateral（双边滤波）

双边滤波器在平滑图像的同时保留边缘，这对于避免图像模糊非常重要，算法相对简单，计算效率较高

### NLMeans Filter（非局部均值滤波）

非局部均值滤波可以更好地去除噪声，同时保留更多的细节和纹理。它通过搜索整个图像中的相似块进行降噪，适应性较强，能够处理不同类型的噪声。对于复杂的、空间相关的噪声也有很好的去除效果。对低光视频拍摄中的噪声去除、老旧影片的修复都很有帮助

:::warning 警告
nlmeans 方法降噪会大幅增加视频处理时间（成倍增长），请谨慎使用
:::

## 分辨率缩放算法

### 1. NEAREST（最近邻插值）
优势：
- 计算简单：最近邻插值的计算量最小，因此速度非常快。
- 无额外模糊：不会引入额外的模糊，保持原始像素的硬边缘。

适用场所：
- 实时处理：需要快速计算的场合，例如实时视频流处理。
- 低分辨率图像：放大像素艺术（如像素游戏图像）时效果较好。

缺点：
- 图像质量低：可能产生锯齿效应和马赛克现象，缩放后图像质量较差。
- 细节丢失：不适合需要高质量图像的场合。

### 2. BILINEAR（双线性插值）
优势：
- 平滑过渡：相比最近邻插值，双线性插值在图像缩放时能产生平滑过渡效果。
- 计算较快：计算复杂度较低，适合快速处理需求。

适用场所：
- 一般视频缩放：适用于对质量要求不高的常规视频缩放。
- 实时应用：如网络视频流、视频聊天等需要快速响应的场合。

缺点：
- 细节损失：图像边缘会变得模糊，细节部分容易丢失。
- 模糊效果：较大的缩放比例会导致图像明显模糊。

### 3. BICUBIC（双三次插值）
优势：
- 高质量：相比双线性插值，双三次插值在缩放过程中能更好地保留细节。
- 平滑效果好：平滑效果优于双线性插值，缩放后的图像更自然。

适用场所：
- 图像处理：适用于需要较高质量图像缩放的场合，如图像编辑和照片处理。
- 视频后期制作：对视频质量要求较高的后期制作过程。

缺点：
- 计算复杂：计算量较大，处理时间较长，不适合实时处理。
- 可能产生伪影：某些情况下，可能会产生轻微的伪影或边缘增强现象。

### 4. LANCZOS（Lanczos重采样）
优势：
- 高保真度：Lanczos滤波器能最大限度地保留图像细节，缩放效果非常好。
- 平滑自然：提供比双三次插值更好的平滑效果，减少伪影和模糊。

适用场所：
- 高分辨率视频：适合需要保持高分辨率和细节的场合，如4K视频处理。
- 视频转码和放大：对画质有较高要求的场合，如电影制作和视频修复。

缺点：
- 计算复杂：计算量大，处理时间长，通常不适用于实时应用。
- 边缘效应：某些情况下，可能会在高对比度边缘处产生轻微的振铃效应。

### 5. SINC（Sinc插值）
优势：
- 理论最佳：在理论上，Sinc插值可以提供最理想的重建效果，最大程度保留原始信息。
- 高保真度：能很好地保留图像细节，减少失真。

适用场所：
- 高精度图像处理：适用于需要最高精度的图像和视频处理场合，如科学图像处理和高精度视频修复。
- 专业视频制作：用于需要最高质量的专业视频制作和修复。

缺点：
- 计算复杂：计算量非常大，处理时间长，不适用于实时处理。
- 振铃效应：可能会产生振铃效应（ringing artifacts），尤其是在高对比度边缘。

### 总结
- NEAREST：适合实时处理和像素艺术，但质量较低。
- BILINEAR：适合一般视频缩放，速度快但模糊。
- BICUBIC：适合需要高质量的图像和视频处理，但计算复杂。
- LANCZOS：适合高分辨率和高质量视频处理，但计算复杂。
- SINC：适合最高精度和专业用途，但计算最复杂。

## 视频补帧算法

### 普通补帧（Frame Interpolation）

普通视频补帧方法（如重复帧、线性插值）通常计算简单，速度较快。

### 光流法视频补帧（Optical Flow Interpolation）

光流法利用运动矢量进行插值，能够生成高质量的中间帧，减少模糊和伪影。插值帧效果更自然，尤其在处理复杂运动场景时表现优异。能够更好地保留图像细节和边缘，提升视觉体验。

:::warning 警告
启用该选项会大幅增加处理时间

光流法计算量大，处理时间长，需要高性能的计算资源。
:::

## 输出视频编码

**默认情况下推荐只使用 H264 模式(速度均衡，压缩率高，画面损失肉眼几乎不可见)**，如果您拥有显卡，使用硬件编码速度会非常快，不过您需要确保您的环境支持使用硬件编码

一些编码器依赖于特定的硬件加速，所以需要确保你的系统中有相应的硬件。例如：

*h264_qsv 和 hevc_qsv 需要Intel CPU并启用Quick Sync Video。*

*h264_amf 和 hevc_amf 需要AMD GPU并启用AMF。*

*h264_nvenc 和 hevc_nvenc 需要NVIDIA GPU并启用NVENC。*

确保你安装了最新的硬件驱动，以及相应的依赖库。例如：

*Intel: 需要安装Intel Media SDK。*

*AMD: 需要安装AMF SDK。*

*NVIDIA: 需要安装NVIDIA驱动和CUDA。*

## 音频采样率

音频采样率，决定视频的音频质量的好坏，现在有下面的这些值支持选取

- "8kHz-电话音质",
- "16kHz-低质量音乐录音",
- "22.05kHz-AM广播质量",
- "32kHz-FM广播质量",
- "44.1kHz-CD音质",
- "96kHz-高解析度音频"